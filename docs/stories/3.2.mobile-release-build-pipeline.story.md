# Story 3.2: Mobile Release Build Pipeline (Android & iOS)

## Status
Approved

## Story
**As a** Mobile Developer,
**I want** to generate signed Android APK/AAB and iOS IPA files,
**so that** I can publish the mobile versions alongside the desktop versions.

## Acceptance Criteria
1. The build process generates a signed release APK for Android.
2. The build process generates an IPA (or Xcode archive) for iOS (via Capacitor).
3. The Android/iOS builds are integrated into the GitHub Release workflow (or documented manual upload if signing automation is blocked).
4. The APK and IPA install and run on physical devices.

## Tasks / Subtasks
- [ ] Configure Android Release Build (AC: 1)
    - [ ] Check for existing `release-keystore.jks` (do not commit). If missing, generate a development keystore using `keytool -genkey -v -keystore release-keystore.jks -keyalg RSA -keysize 2048 -validity 10000 -alias dev-alias` (document this in `RELEASE_PROCESS.md`).
    - [ ] Configure `android/app/build.gradle` signing configs for release build type to read from environment variables or `gradle.properties` (not committed).
    - [ ] Document the command to generate signed APK/AAB (e.g., `./gradlew assembleRelease`).
- [ ] Configure iOS Release Build (AC: 2)
    - [ ] Check if `netmonitor/ios` exists. If not, run `npx cap add ios` to initialize the platform.
    - [ ] Verify `npx cap open ios` opens Xcode project correctly.
    - [ ] Document the manual Archive process in Xcode (since automated iOS builds often require paid Apple Dev account and mac runner, documenting the manual process for the "GitHub Release integration" aspect is the MVP approach unless user confirms automation capability).
    - [ ] [Source: architecture/development-and-deployment.md#build-and-deployment-process]
- [ ] Integrate/Document Workflow (AC: 3)
    - [ ] Update `docs/RELEASE_PROCESS.md` with specific steps for Mobile (Manual generation & upload for now, or local script).
    - [ ] **Android CI Automation Scope**: Attempt to add a `release-android` job to `.github/workflows/release.yml` that runs `./gradlew assembleRelease`.
        - [ ] This job should only run if the required `ANDROID_KEYSTORE_BASE64` secret is present. If not, it should be skipped or documented as a "future capability" requiring secrets setup.
    - [ ] For iOS: Document manual upload to GitHub Release assets.
- [ ] Verification (AC: 4)
    - [ ] Generate Android APK locally.
    - [ ] Install on test device/emulator (drag & drop to emulator or `adb install`).
    - [ ] Verify basic functionality (network monitoring graph updates).

## Dev Notes
**Context:**
This is Story 3.2, focusing on the mobile artifacts. We have already automated Desktop builds (Story 3.1).

**Previous Story Insights:**
- Story 3.1 successfully used GitHub Actions for Desktop.
- Mobile builds (especially iOS) have stricter signing requirements.

**File Locations:**
- **Android Project:** `netmonitor/android/` [Source: architecture/source-tree-and-module-organization.md]
- **Build Config:** `netmonitor/android/app/build.gradle`
- **Release Docs:** `docs/RELEASE_PROCESS.md`

**Technical Details:**
- **Android Signing:** Requires a `.keystore` or `.jks` file. This should NOT be committed to git.
- **GitHub Secrets:** `ANDROID_KEYSTORE_BASE64`, `KEYSTORE_PASSWORD`, `KEY_ALIAS`, `KEY_PASSWORD` would be needed for CI.
- **iOS:** Requires a Mac. Since Story 3.1 used `macos-latest` runner, we *could* build iOS there, but it requires an Apple Developer account certificate and provisioning profile to be exported and loaded into the runner. Given the complexity and potential cost barriers, documenting the *manual* archive process is a safer MVP unless specifically asked to automate.
- **Capacitor:** We use `npx cap sync` to update native projects before building.

**Project Structure Alignment:**
- Android project exists in `netmonitor/android`.
- iOS project (if initialized) would be in `netmonitor/ios`. Task added to verify/create this.

**Testing Requirements:**
- **Manual Verification:** Install the generated APK on a real device or emulator.
- **CI Verification:** If Android CI job is added, it must pass `assembleRelease`.

## Change Log
| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 08/12/2025 | 1.0 | Initial Draft | Bob (Scrum Master) |
| 08/12/2025 | 1.1 | Clarified Keystore, iOS platform, and CI scope | Sarah (Product Owner) |

## Dev Agent Record
### Agent Model Used


### Debug Log References


### Completion Notes List


### File List

## QA Results
